\chapter{Overview}\label{sec:overview}

\section{Workflow Overview}

\cxoneflow has origins in CxFlow for the CxSAST product (CxSAST is the predecessor to \cxonens).  CxFlow
had a variety of functions and deployment options related to orchestrating scans in CxSAST and sending
result feedback to issue trackers.  \cxoneflow will also orchestrate scans but is adapted for the
concepts of \cxonens.

The \cxoneflow logic for how scans are orchestrated is very similar to that of CxFlow.  The basic
logic flow is that scans are executed when:

\begin{itemize}
    \item If a Push is made to a repository's protected branch, that protected branch is scanned.
    \item If a Pull Request is opened that targets a protected branch, a scan is performed on
    the source branch.
    \item If a Push is made to a branch that is the source of an open Pull Request that targets
    a protected branch, the open Pull Request branch is scanned.
\end{itemize}


\cxoneflow follows this workflow logic upon the receipt of a webhook event payload generated by the
source control management system (SCM). The code from the repository to be scanned is cloned by \cxoneflowns, 
collected into a zip file, then submitted for a scan to \cxonens.  When the scan is submitted,
the locally cloned code is deleted.


\section{Deployment Overview}

The method of deployment for \cxoneflow is intended to integrate scanning of all enterprise repositories
with a minimal amount of configuration.  The best method for deployment is to configure source control web
hooks where they will emit events for the largest possible number of repositories.  In many source control
systems, this can be done at a global or organization level.  The web hooks will be configured to send events
to a \cxoneflow endpoint specific to the type of source control system.

Figure \ref{fig:cxoneflow-deployment} is a \cxoneflow deployment diagram. The key points of the diagram:

\begin{itemize}
    \item A single instance or clustered install of \cxoneflow can be used as the endpoint for multiple
    SCM instances.
    \item There may be more than one instance of an SCM type.
    \item Each SCM may host logically separate organizations that can use the same \cxoneflow endpoint.
    The endpoint would be configured with multiple service instances to match multiple organizations.
    \item There may be multiple \cxone tenants where scans are to be invoked from an SCM or SCM
    logical group of repositories.
\end{itemize}

The \cxoneflow configuration allows each SCM receiver endpoint to be configured such that it orchestrates
scans in the correct target \cxone instance and tenant. \cxoneflow is compatible with \cxone hosted 
single-tenant, hosted multi-tenant, and self-hosted instances.

\begin{figure}[ht]
    \includegraphics[width=\textwidth]{graphics/cxoneflow-deployment.png}
    \caption{\cxoneflow Deployment Diagram}
    \label{fig:cxoneflow-deployment}
\end{figure}

\section{Webhook Deployment Topology}

The goal of any \cxoneflow deployment is to enable webhook event delivery for a
large number of code repositories without a significant amount of effort.  Each 
SCM has several webhook deployment topologies that can be utilized to allow
deployment with the most minimal amount of effort. External factors can influence
what would be considered the most minimal amount of effort.

There are many factors that should be considered when considering the deployment
approach.  In some cases, some of the SCM webhook deployment capabilities may
not be utilized based on other considered factors.  Some of the
other factors to consider can include:

\begin{itemize}
    \item Administrative control of one or more SCM instances.
    \item Administrative control of multiple organizations in an SCM instance.
    \item Existing SCM integrations.
    \item Repository usage patterns that align with multiple development teams and Software Development Lifecycles.
\end{itemize}

This section is intended to provide a brief overview of the supported SCM repository organization topologies.
This overview is not comprehensive; a deeper look into your organization's SCMs may be required
to understand the full scope of deployment work. Part \ref{part:scms} of this manual covers the
details for integrating \cxoneflow with each supported SCM type.

The tool \extlink{https://github.com/checkmarx-ts/cxone-flow-audit}{cxone-flow-audit} has been
developed to assist in automating and auditing large scale deployments in some scenarios.  As
of the writing of this manual, the capabilities are limited to Azure DevOps.  As time progresses,
more deployment assistance capabilities will be added.


\subsection{BitBucket Data Center Webhook Topology}

\input{scms/topology/bbdc.tex}

\subsection{Azure DevOps Webhook Topology}

\input{scms/topology/adoe.tex}

\subsection{GitHub Webhook Topology}

\input{scms/topology/gh.tex}

\subsection{Gitlab Webhook Topology}

\input{scms/topology/gl.tex}

